<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ctas.web.mybatis.mapper.CurrencyRateMapper">
    <resultMap id="currencyRateResultMap" type="ctas.entity.CurrencyRate">
        <id column="REC_ID" property="recId" jdbcType="DECIMAL"/>
        <result column="CURRENCY" property="currency" jdbcType="VARCHAR"/>
        <result column="RATE" property="rate" jdbcType="DECIMAL"/>
        <result column="BILL_DATE" property="billDate" jdbcType="DECIMAL"/>
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="CREATOR_ID" property="creatorId" jdbcType="VARCHAR"/>
        <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="UPDATER_ID" property="updaterId" jdbcType="VARCHAR"/>
        <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="currencyRateDtoResultMap" type="ctas.web.dto.bas.CurrencyRateDto">
        <id column="REC_ID" property="recId" jdbcType="DECIMAL"/>
        <result column="ROWNUM" property="rowNum" jdbcType="DECIMAL"/>
        <result column="CURRENCY" property="currency" jdbcType="VARCHAR"/>
        <result column="RATE" property="rate" jdbcType="DECIMAL"/>
        <result column="BILL_DATE" property="billDate" jdbcType="DECIMAL"/>
    </resultMap>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        delete from CTAS_CURRENCY_RATE
        where REC_ID = #{recId,jdbcType=DECIMAL}
    </delete>
    <insert id="insert" parameterType="ctas.entity.CurrencyRate">
        <selectKey keyProperty="recId" order="BEFORE" resultType="Long">
            select SEQ_CTAS_CURRENCY_RATE.nextval as recId from dual
        </selectKey>
        insert into CTAS_CURRENCY_RATE (REC_ID, CURRENCY, RATE,
        BILL_DATE, CREATE_TIME, CREATOR_ID,
        UPDATE_TIME,UPDATER_ID, COMPANY_CODE)
        values (#{recId,jdbcType=DECIMAL}, #{currency,jdbcType=VARCHAR}, #{rate,jdbcType=DECIMAL},
        #{billDate,jdbcType=DECIMAL}, #{createTime,jdbcType=TIMESTAMP},
        #{creatorId,jdbcType=VARCHAR}, #{updateTime,jdbcType=TIMESTAMP}, #{updaterId,jdbcType=VARCHAR},
        #{companyCode,jdbcType=VARCHAR})
    </insert>
    <update id="updateByPrimaryKey" parameterType="ctas.entity.CurrencyRate">
        update CTAS_CURRENCY_RATE
        set CURRENCY = #{currency,jdbcType=VARCHAR},
        RATE = #{rate,jdbcType=DECIMAL},
        BILL_DATE = #{billDate,jdbcType=DECIMAL},
        UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
        UPDATER_ID = #{updaterId,jdbcType=VARCHAR}
        where REC_ID = #{recId,jdbcType=DECIMAL}
    </update>
    <select id="selectCurrencyByCondition" parameterType="java.util.Map" resultMap="currencyRateDtoResultMap">
        SELECT ROWNUM, C.*
        FROM (SELECT T.REC_ID, T.CURRENCY, T.RATE,
        T.BILL_DATE, T.CREATE_TIME, T.CREATOR_ID,
        T.UPDATE_TIME, T.UPDATER_ID
        FROM CTAS_CURRENCY_RATE T
        WHERE T.COMPANY_CODE = #{companyCode,jdbcType=VARCHAR}
        <if test="billDate != null and '' != billDate">
          AND T.BILL_DATE = #{billDate,jdbcType=DECIMAL}
        </if>
        <if test="currency != null and '' != currency">
          AND T.CURRENCY = #{currency,jdbcType=VARCHAR}
        </if>
        ORDER BY  T.BILL_DATE DESC,T.CURRENCY) C
    </select>
    <select id="getCurrencyByPrimaryKey" parameterType="java.lang.Long" resultMap="currencyRateResultMap">
        SELECT T.REC_ID, T.CURRENCY, T.RATE,
        T.BILL_DATE, T.CREATE_TIME, T.CREATOR_ID,
        T.UPDATE_TIME, T.UPDATER_ID
        FROM CTAS_CURRENCY_RATE T
        WHERE T.REC_ID = #{recId,jdbcType=DECIMAL}
    </select>
    <select id="isUniqueCurrency" parameterType="ctas.entity.CurrencyRate" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM CTAS_CURRENCY_RATE T
        WHERE T.COMPANY_CODE = #{companyCode,jdbcType=VARCHAR}
        <if test="billDate != null and '' != billDate">
            AND T.BILL_DATE = #{billDate,jdbcType=DECIMAL}
        </if>
        <if test="currency != null and '' != currency">
            AND T.CURRENCY = #{currency,jdbcType=VARCHAR}
        </if>
        <if test="recId != null and '' != recId">
            AND T.REC_ID != #{recId,jdbcType=DECIMAL}
        </if>
    </select>
</mapper>